<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DREVO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #00B894; --light: #00D4AA; --dark: #009975;
            --bg: #0A0A0A; --card: #1A1A1A; --text: #FFFFFF; --secondary: #A0A0A0;
            --gold: #FFD700; --silver: #C0C0C0; --bronze: #CD7F32;
        }
        body { font-family: 'Roboto', sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        .app { height: 100vh; display: flex; flex-direction: column; }
        
        /* Header */
        .header { background: var(--card); padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 8px; font-size: 20px; font-weight: 700; color: var(--primary); }
        .balance-section { display: flex; align-items: center; gap: 12px; }
        .balance-card, .energy-section { background: var(--bg); padding: 8px 12px; border-radius: 12px; display: flex; align-items: center; gap: 6px; font-size: 14px; font-weight: 600; }
        
        /* Navigation */
        .tabs { display: flex; background: var(--card); margin: 0 12px; border-radius: 12px; overflow: hidden; }
        .tab-btn { flex: 1; padding: 14px; background: none; border: none; color: var(--secondary); font-size: 14px; font-weight: 500; cursor: pointer; }
        .tab-btn.active { background: var(--primary); color: white; }
        
        /* Content */
        .content { flex: 1; overflow-y: auto; padding: 0 12px 20px; }
        .tab-content { display: none; height: 100%; }
        .tab-content.active { display: block; }
        
        /* Clicker Section */
        .clicker-section { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .daily-bonus { background: var(--primary); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-bottom: 20px; }
        .clicker-circle { width: 220px; height: 220px; border-radius: 50%; background: var(--card); display: flex; align-items: center; justify-content: center; margin: 20px 0; position: relative; }
        .clicker-btn { width: 180px; height: 180px; border-radius: 50%; background: var(--primary); border: none; cursor: pointer; transition: all 0.1s ease; display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: 700; color: white; }
        .clicker-btn:active { transform: scale(0.95); }
        .stats-section { background: var(--card); border-radius: 16px; padding: 16px; width: 100%; max-width: 320px; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; }
        .progress-bar { width: 100%; height: 6px; background: #2A2A2A; border-radius: 3px; overflow: hidden; margin-top: 4px; }
        .progress-fill { height: 100%; background: var(--primary); transition: width 0.3s ease; }
        
        /* Tasks Section */
        .tasks-section { background: var(--card); border-radius: 16px; padding: 20px; margin-top: 20px; }
        .section-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; }
        .tasks-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .task-card { background: var(--bg); border-radius: 12px; padding: 16px; text-align: center; }
        .task-title { font-size: 12px; color: var(--secondary); margin-bottom: 4px; }
        .task-reward { font-size: 14px; font-weight: 700; color: var(--primary); }
        .task-btn { width: 100%; padding: 8px; background: var(--primary); border: none; border-radius: 8px; color: white; font-size: 12px; font-weight: 600; cursor: pointer; margin-top: 8px; }
        .task-btn.completed { background: var(--secondary); cursor: not-allowed; }
        
        /* Leaders Section */
        .leaders-section { padding: 20px 0; }
        .leaderboard { background: var(--card); border-radius: 16px; padding: 20px; }
        .leader-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid #2A2A2A; }
        .leader-avatar-large { width: 48px; height: 48px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 18px; }
        .leader-user-info { flex: 1; }
        .leader-username { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .leader-stats { font-size: 12px; color: var(--secondary); }
        .leader-motivation { background: rgba(0, 184, 148, 0.1); border-radius: 12px; padding: 16px; margin-bottom: 20px; text-align: center; font-size: 14px; line-height: 1.4; }
        .leader-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #2A2A2A; }
        .leader-item:last-child { border-bottom: none; }
        .leader-rank { width: 24px; font-weight: 600; margin-right: 12px; text-align: center; }
        .rank-1 { color: var(--gold); }
        .rank-2 { color: var(--silver); }
        .rank-3 { color: var(--bronze); }
        .leader-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 12px; font-size: 14px; }
        .leader-info { flex: 1; }
        .leader-name { font-size: 14px; font-weight: 500; }
        .leader-score { font-size: 14px; font-weight: 600; color: var(--primary); }
        .current-user { background: rgba(0, 184, 148, 0.1); border-radius: 8px; margin: 0 -8px; padding: 0 8px; }
        
        /* Investments Section */
        .investments-section { padding: 20px 0; }
        .investments-info { background: rgba(255, 193, 7, 0.1); border: 1px solid #FFC107; border-radius: 12px; padding: 16px; margin-bottom: 20px; font-size: 12px; line-height: 1.4; }
        .investments-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .investment-card { background: var(--card); border-radius: 16px; padding: 20px; }
        .investment-header { display: flex; justify-content: between; align-items: center; margin-bottom: 16px; }
        .investment-icon { width: 40px; height: 40px; border-radius: 10px; background: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 12px; }
        .investment-info { flex: 1; }
        .investment-name { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .investment-details { font-size: 12px; color: var(--secondary); }
        .investment-stats { display: flex; justify-content: space-between; margin-bottom: 16px; }
        .stat { text-align: center; }
        .stat-value { font-size: 18px; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 10px; color: var(--secondary); margin-top: 4px; }
        .buy-btn { width: 100%; padding: 12px; background: var(--primary); border: none; border-radius: 8px; color: white; font-size: 14px; font-weight: 600; cursor: pointer; }
        .buy-btn:disabled { background: var(--secondary); cursor: not-allowed; }
        
        /* Loading */
        .loading { text-align: center; padding: 40px; color: var(--secondary); }
        .loading-spinner { width: 20px; height: 20px; border: 2px solid var(--secondary); border-top: 2px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Animations */
        @keyframes coinPop { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-60px) scale(1.1); opacity: 0; } }
        .coin-pop { animation: coinPop 0.8s ease-out forwards; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .pulse { animation: pulse 2s infinite; }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <div class="logo">DREVO</div>
            <div class="balance-section">
                <div class="energy-section"><span id="energy">1000/1000</span></div>
                <div class="balance-card"><span id="balance">0</span></div>
            </div>
        </div>
        
        <!-- Navigation -->
        <nav class="tabs">
            <button class="tab-btn active" onclick="switchTab('clicker')">Clicker</button>
            <button class="tab-btn" onclick="switchTab('tasks')">Tasks</button>
            <button class="tab-btn" onclick="switchTab('investments')">Investments</button>
            <button class="tab-btn" onclick="switchTab('leaders')">Leaders</button>
        </nav>
        
        <main class="content">
            <!-- Clicker Tab -->
            <div id="clicker-tab" class="tab-content active">
                <div class="clicker-section">
                    <div class="daily-bonus">Daily limit</div>
                    <div class="clicker-circle">
                        <button class="clicker-btn pulse" id="click-btn">D</button>
                    </div>
                    <div class="stats-section">
                        <div class="stat-row"><span>Points per tap</span><span>+1</span></div>
                        <div class="stat-row"><span>Daily limit</span><span id="today-limit">0/1000</span></div>
                        <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width: 0%"></div></div>
                    </div>
                </div>
            </div>
            
            <!-- Tasks Tab -->
            <div id="tasks-tab" class="tab-content">
                <div class="tasks-section">
                    <div class="section-title">Tasks</div>
                    <div class="tasks-grid">
                        <div class="task-card" id="task-channel1">
                            <div class="task-title">Join DREVO Coin</div>
                            <div class="task-reward">+1000 D</div>
                            <button class="task-btn" onclick="completeTask('channel1')">Join</button>
                        </div>
                        <div class="task-card" id="task-channel2">
                            <div class="task-title">Join OneSK</div>
                            <div class="task-reward">+1000 D</div>
                            <button class="task-btn" onclick="completeTask('channel2')">Join</button>
                        </div>
                        <div class="task-card" id="task-channel3">
                            <div class="task-title">Join BioSprutEl</div>
                            <div class="task-reward">+1000 D</div>
                            <button class="task-btn" onclick="completeTask('channel3')">Join</button>
                        </div>
                        <div class="task-card" id="task-chat">
                            <div class="task-title">Join DREVO Community</div>
                            <div class="task-reward">+1000 D</div>
                            <button class="task-btn" onclick="completeTask('chat')">Join</button>
                        </div>
                        <div class="task-card" id="task-invite">
                            <div class="task-title">Invite Friends</div>
                            <div class="task-reward">+500 D</div>
                            <button class="task-btn" onclick="completeTask('invite')">Invite</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Investments Tab -->
            <div id="investments-tab" class="tab-content">
                <div class="investments-section">
                    <div class="investments-info">
                        ⚠️ Important: Investments generate coins only while you are actively in the game. When you exit, income stops.
                    </div>
                    <div class="investments-grid">
                        <div class="investment-card">
                            <div class="investment-header">
                                <div class="investment-icon">T</div>
                                <div class="investment-info">
                                    <div class="investment-name">Telegram</div>
                                    <div class="investment-details">Social platform</div>
                                </div>
                            </div>
                            <div class="investment-stats">
                                <div class="stat">
                                    <div class="stat-value">2600</div>
                                    <div class="stat-label">Cost</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value">1/min</div>
                                    <div class="stat-label">Income</div>
                                </div>
                            </div>
                            <button class="buy-btn" onclick="buyInvestment('telegram')" id="buy-telegram">Buy Telegram</button>
                        </div>
                        
                        <div class="investment-card">
                            <div class="investment-header">
                                <div class="investment-icon">Y</div>
                                <div class="investment-info">
                                    <div class="investment-name">YouTube</div>
                                    <div class="investment-details">Video platform</div>
                                </div>
                            </div>
                            <div class="investment-stats">
                                <div class="stat">
                                    <div class="stat-value">3300</div>
                                    <div class="stat-label">Cost</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value">1/min</div>
                                    <div class="stat-label">Income</div>
                                </div>
                            </div>
                            <button class="buy-btn" onclick="buyInvestment('youtube')" id="buy-youtube">Buy YouTube</button>
                        </div>
                        
                        <div class="investment-card">
                            <div class="investment-header">
                                <div class="investment-icon">T</div>
                                <div class="investment-info">
                                    <div class="investment-name">Twitch</div>
                                    <div class="investment-details">Streaming platform</div>
                                </div>
                            </div>
                            <div class="investment-stats">
                                <div class="stat">
                                    <div class="stat-value">4200</div>
                                    <div class="stat-label">Cost</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value">2/min</div>
                                    <div class="stat-label">Income</div>
                                </div>
                            </div>
                            <button class="buy-btn" onclick="buyInvestment('twitch')" id="buy-twitch">Buy Twitch</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Leaders Tab -->
            <div id="leaders-tab" class="tab-content">
                <div class="leaders-section">
                    <div class="leaderboard">
                        <div class="leader-header">
                            <div class="leader-avatar-large" id="user-avatar-large">U</div>
                            <div class="leader-user-info">
                                <div class="leader-username" id="leader-username">User</div>
                                <div class="leader-stats" id="leader-stats">0 coins • Just started</div>
                            </div>
                        </div>
                        
                        <div class="leader-motivation">
                            It's never too late to enter the top rankings, hurry up to take your place in the rating. After listing, when the coin is listed on the exchange, top players will have a special advantage.
                        </div>
                        
                        <div class="section-title">Top Players</div>
                        <div id="leaders-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <div>Loading leaderboard...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        class DREVOApp {
            #tg = window.Telegram.WebApp;
            #LEADERBOARD_KEY = 'drevo_global_leaderboard_v2';
            #incomeInterval = null;
            
            state = {
                balance: 0,
                energy: 1000,
                clicksToday: 0,
                completedTasks: new Map([
                    ['channel1', false],
                    ['channel2', false],
                    ['channel3', false],
                    ['chat', false],
                    ['invite', false]
                ]),
                investments: new Map([
                    ['telegram', false],
                    ['youtube', false],
                    ['twitch', false]
                ]),
                userId: null,
                username: 'User',
                registrationDate: null,
                lastClickDate: null
            };

            constructor() {
                this.init();
            }

            init() {
                this.#tg.expand();
                this.setupUser();
                this.loadState();
                this.setupEventListeners();
                this.startIncomeGeneration();
                this.updateUI();
                this.updateLeadersBoard();
                
                // Auto-update leaderboard every 5 seconds
                setInterval(() => this.updateLeadersBoard(), 5000);
            }

            setupUser() {
                const user = this.#tg.initDataUnsafe.user;
                this.state.userId = user?.id ?? Math.floor(Math.random() * 1000000000);
                this.state.username = user?.first_name ?? `User${this.state.userId.toString().slice(-4)}`;
                
                this.initializeUserInLeaderboard();
            }

            initializeUserInLeaderboard() {
                const globalLeaderboard = this.getGlobalLeaderboard();
                const existingUser = globalLeaderboard.find(u => u.id === this.state.userId);
                
                if (!existingUser) {
                    this.state.registrationDate = Date.now();
                    globalLeaderboard.push({
                        id: this.state.userId,
                        name: this.state.username,
                        score: 0,
                        lastActive: Date.now(),
                        registrationDate: this.state.registrationDate
                    });
                    this.saveGlobalLeaderboard(globalLeaderboard);
                } else {
                    existingUser.name = this.state.username;
                    existingUser.lastActive = Date.now();
                    if (!existingUser.registrationDate) {
                        existingUser.registrationDate = Date.now();
                    }
                    this.state.registrationDate = existingUser.registrationDate;
                    this.saveGlobalLeaderboard(globalLeaderboard);
                }
            }

            getGlobalLeaderboard() {
                try {
                    return JSON.parse(localStorage.getItem(this.#LEADERBOARD_KEY)) ?? [];
                } catch {
                    return [];
                }
            }

            saveGlobalLeaderboard(leaderboard) {
                const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
                const activeLeaderboard = leaderboard.filter(user => user.lastActive > thirtyDaysAgo);
                
                activeLeaderboard.sort((a, b) => b.score - a.score);
                
                localStorage.setItem(this.#LEADERBOARD_KEY, JSON.stringify(activeLeaderboard));
                return activeLeaderboard;
            }

            updateUserScore() {
                const globalLeaderboard = this.getGlobalLeaderboard();
                const userIndex = globalLeaderboard.findIndex(u => u.id === this.state.userId);
                
                if (userIndex !== -1) {
                    globalLeaderboard[userIndex].score = this.state.balance;
                    globalLeaderboard[userIndex].lastActive = Date.now();
                    globalLeaderboard[userIndex].name = this.state.username;
                    this.saveGlobalLeaderboard(globalLeaderboard);
                }
            }

            switchTab(tabName, event) {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                event.target.classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                if (tabName === 'tasks') this.updateTasksUI();
                if (tabName === 'investments') this.updateInvestmentsUI();
                if (tabName === 'leaders') this.updateLeadersBoard();
            }

            loadState() {
                const userKey = `drevoState_${this.state.userId}`;
                const saved = localStorage.getItem(userKey);
                
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        const today = new Date().toDateString();
                        
                        if (parsed.lastClickDate !== today) { 
                            this.state.clicksToday = 0; 
                            this.state.energy = 1000; 
                        } else { 
                            this.state.clicksToday = parsed.clicksToday ?? 0; 
                            this.state.energy = 1000 - this.state.clicksToday; 
                        }
                        
                        this.state.balance = parsed.balance ?? 0;
                        
                        // Convert completed tasks from object to Map
                        if (parsed.completedTasks) {
                            Object.entries(parsed.completedTasks).forEach(([key, value]) => {
                                this.state.completedTasks.set(key, value);
                            });
                        }
                        
                        // Convert investments from object to Map
                        if (parsed.investments) {
                            Object.entries(parsed.investments).forEach(([key, value]) => {
                                this.state.investments.set(key, value);
                            });
                        }
                        
                        this.state.registrationDate = parsed.registrationDate ?? Date.now();
                        this.state.lastClickDate = today;
                        
                    } catch (error) {
                        console.error('Error loading state:', error);
                        this.resetState();
                    }
                } else {
                    this.resetState();
                }
                
                this.saveState();
            }

            resetState() {
                this.state.balance = 0;
                this.state.energy = 1000;
                this.state.clicksToday = 0;
                
                // Reset all tasks to false
                for (const key of this.state.completedTasks.keys()) {
                    this.state.completedTasks.set(key, false);
                }
                
                // Reset all investments to false
                for (const key of this.state.investments.keys()) {
                    this.state.investments.set(key, false);
                }
                
                this.state.registrationDate = Date.now();
                this.state.lastClickDate = new Date().toDateString();
            }

            saveState() { 
                const userKey = `drevoState_${this.state.userId}`;
                this.state.lastClickDate = new Date().toDateString();
                
                // Convert Maps to objects for storage
                const stateToSave = {
                    ...this.state,
                    completedTasks: Object.fromEntries(this.state.completedTasks),
                    investments: Object.fromEntries(this.state.investments)
                };
                
                localStorage.setItem(userKey, JSON.stringify(stateToSave));
                this.updateUserScore();
            }

            setupEventListeners() { 
                document.getElementById('click-btn').addEventListener('click', () => this.handleClick()); 
            }

            startIncomeGeneration() {
                if (this.#incomeInterval) {
                    clearInterval(this.#incomeInterval);
                }
                
                this.#incomeInterval = setInterval(() => {
                    let income = 0;
                    
                    if (this.state.investments.get('telegram')) income += 1;
                    if (this.state.investments.get('youtube')) income += 1;
                    if (this.state.investments.get('twitch')) income += 2;
                    
                    if (income > 0) {
                        this.state.balance += income;
                        this.saveState();
                        this.updateUI();
                        this.updateLeadersBoard();
                        
                        this.#tg.showPopup({
                            title: 'Investment Income!',
                            message: `You earned ${income} coins from your investments!`,
                            buttons: [{ type: 'ok' }]
                        });
                    }
                }, 60000);
            }

            handleClick() {
                if (this.state.energy <= 0) { 
                    this.#tg.showAlert('Daily limit reached!'); 
                    return; 
                }
                this.state.balance++; 
                this.state.energy--; 
                this.state.clicksToday++;
                this.showCoinAnimation(); 
                this.#tg.HapticFeedback.impactOccurred('light'); 
                this.saveState(); 
                this.updateUI();
                this.updateLeadersBoard();
            }

            showCoinAnimation() {
                const coin = document.createElement('div'); 
                coin.className = 'coin-pop'; 
                coin.textContent = '+1'; 
                coin.style.cssText = 'position:absolute;font-size:16px;font-weight:700;color:#00B894;opacity:0;';
                document.getElementById('click-btn').parentElement.appendChild(coin); 
                setTimeout(() => coin.remove(), 800);
            }

            completeTask(taskId) {
                if (this.state.completedTasks.get(taskId)) { 
                    this.#tg.showAlert('Task already completed!'); 
                    return; 
                }
                
                const urls = new Map([
                    ['channel1', 'https://t.me/drevocoin'],
                    ['channel2', 'https://t.me/onesk'],
                    ['channel3', 'https://t.me/biosprutel'],
                    ['chat', 'https://t.me/drevocommunity'],
                    ['invite', 'https://t.me/share/url?url=https://t.me/drevo_bot']
                ]);
                
                if (urls.has(taskId)) {
                    this.#tg.openLink(urls.get(taskId));
                }
                
                // Give reward immediately
                const reward = taskId === 'invite' ? 500 : 1000;
                this.state.balance += reward; 
                this.state.completedTasks.set(taskId, true);
                this.#tg.HapticFeedback.impactOccurred('success');
                
                this.#tg.showPopup({ 
                    title: 'Task Completed!', 
                    message: `You received ${reward} DREVO points!`, 
                    buttons: [{ type: 'ok' }] 
                });
                
                this.saveState(); 
                this.updateUI(); 
                this.updateTasksUI();
                this.updateLeadersBoard();
            }

            buyInvestment(investmentId) {
                const prices = new Map([
                    ['telegram', 2600],
                    ['youtube', 3300],
                    ['twitch', 4200]
                ]);
                
                const price = prices.get(investmentId);
                
                if (this.state.balance < price) {
                    this.#tg.showAlert(`Not enough coins! You need ${price} coins.`);
                    return;
                }
                
                if (this.state.investments.get(investmentId)) {
                    this.#tg.showAlert('You already own this investment!');
                    return;
                }
                
                this.state.balance -= price;
                this.state.investments.set(investmentId, true);
                
                this.#tg.showPopup({
                    title: 'Investment Purchased!',
                    message: `You successfully bought ${investmentId.charAt(0).toUpperCase() + investmentId.slice(1)}!`,
                    buttons: [{ type: 'ok' }]
                });
                
                this.saveState();
                this.updateUI();
                this.updateInvestmentsUI();
                this.updateLeadersBoard();
            }

            updateUI() {
                document.getElementById('balance').textContent = this.state.balance.toLocaleString();
                document.getElementById('energy').textContent = `${this.state.energy}/1000`;
                document.getElementById('today-limit').textContent = `${this.state.clicksToday}/1000`;
                document.getElementById('progress-fill').style.width = `${(this.state.clicksToday / 1000) * 100}%`;
                
                const clickBtn = document.getElementById('click-btn');
                if (this.state.energy <= 0) { 
                    clickBtn.classList.remove('pulse'); 
                    clickBtn.style.opacity = '0.6'; 
                } else { 
                    clickBtn.classList.add('pulse'); 
                    clickBtn.style.opacity = '1'; 
                }
            }

            updateTasksUI() {
                for (const [taskId] of this.state.completedTasks) {
                    const taskCard = document.getElementById(`task-${taskId}`); 
                    if (taskCard) {
                        const btn = taskCard.querySelector('.task-btn');
                        
                        if (this.state.completedTasks.get(taskId)) {
                            btn.textContent = 'Completed'; 
                            btn.disabled = true; 
                            btn.classList.add('completed');
                        } else {
                            btn.textContent = taskId === 'invite' ? 'Invite' : 'Join';
                            btn.disabled = false;
                            btn.classList.remove('completed');
                        }
                    }
                }
            }

            updateInvestmentsUI() {
                const investments = ['telegram', 'youtube', 'twitch'];
                for (const investment of investments) {
                    const btn = document.getElementById(`buy-${investment}`);
                    if (btn) {
                        if (this.state.investments.get(investment)) {
                            btn.textContent = 'Owned';
                            btn.disabled = true;
                        } else {
                            const prices = new Map([
                                ['telegram', 2600],
                                ['youtube', 3300],
                                ['twitch', 4200]
                            ]);
                            btn.textContent = `Buy ${investment.charAt(0).toUpperCase() + investment.slice(1)}`;
                            btn.disabled = this.state.balance < prices.get(investment);
                        }
                    }
                }
            }

            updateLeadersBoard() {
                const globalLeaderboard = this.getGlobalLeaderboard();
                const topPlayers = globalLeaderboard.slice(0, 10);

                // Update user info in leader header
                document.getElementById('user-avatar-large').textContent = this.state.username.charAt(0).toUpperCase();
                document.getElementById('leader-username').textContent = this.state.username;
                
                // Calculate time since registration
                const timeDiff = Date.now() - this.state.registrationDate;
                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                
                let timeText = '';
                if (days > 0) {
                    timeText = `${days} day${days > 1 ? 's' : ''}`;
                } else if (hours > 0) {
                    timeText = `${hours} hour${hours > 1 ? 's' : ''}`;
                } else {
                    timeText = `${minutes} minute${minutes > 1 ? 's' : ''}`;
                }
                
                document.getElementById('leader-stats').textContent = 
                    `${this.state.balance.toLocaleString()} coins • Playing for ${timeText}`;

                const leadersList = document.getElementById('leaders-list');
                
                if (topPlayers.length === 0) {
                    leadersList.innerHTML = '<div class="loading">No players yet</div>';
                    return;
                }
                
                leadersList.innerHTML = topPlayers.map((player, index) => {
                    const isCurrentUser = player.id === this.state.userId;
                    const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                    
                    return `
                        <div class="leader-item ${isCurrentUser ? 'current-user' : ''}">
                            <div class="leader-rank ${rankClass}">${index + 1}</div>
                            <div class="leader-avatar">${player.name.charAt(0).toUpperCase()}</div>
                            <div class="leader-info">
                                <div class="leader-name">${player.name} ${isCurrentUser ? '(You)' : ''}</div>
                            </div>
                            <div class="leader-score">${player.score.toLocaleString()} D</div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Global functions for HTML onclick
        function switchTab(tabName) {
            app.switchTab(tabName, event);
        }

        function completeTask(taskId) {
            app.completeTask(taskId);
        }

        function buyInvestment(investmentId) {
            app.buyInvestment(investmentId);
        }

        // Initialize app
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new DREVOApp();
        });
    </script>
</body>
</html>