<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DREVO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-card: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --accent: #0088cc;
            --ton: #0088cc;
            --success: #00c781;
            --border: #2a2a2a;
            --gradient: linear-gradient(135deg, #0088cc, #00c6ff);
            --vip: #ffd700;
            --energy: #ff6b35;
            --drevo: #00c781;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding-bottom: 80px;
            -webkit-touch-callout: none;
            -webkit-user-drag: none;
        }
        
        .container {
            max-width: 428px;
            margin: 0 auto;
            padding: 0 16px;
        }
        
        .header {
            padding: 20px 0;
            text-align: center;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .balance-section {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .energy-section {
            background: var(--bg-card);
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-size: 14px;
            color: var(--energy);
            font-weight: 600;
        }
        
        .balance-card {
            background: var(--bg-card);
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }
        
        .balance-icon {
            color: var(--drevo);
            font-weight: 700;
        }
        
        .section {
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            padding: 0 8px;
        }
        
        .clicker-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .clicker-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 4px solid var(--border);
            transition: transform 0.1s;
            overflow: hidden;
            background: var(--gradient);
            -webkit-touch-callout: none;
            -webkit-user-drag: none;
        }
        
        .clicker-circle:active {
            transform: scale(0.95);
        }
        
        .drevo-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            -webkit-user-drag: none;
        }
        
        .clicker-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--drevo);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .upgrades-grid {
            display: grid;
            gap: 12px;
        }
        
        .upgrade-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid var(--border);
        }
        
        .upgrade-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .upgrade-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }
        
        .upgrade-info {
            flex: 1;
        }
        
        .upgrade-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .upgrade-description {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .upgrade-price {
            font-size: 12px;
            color: var(--drevo);
            font-weight: 600;
        }
        
        .upgrade-button {
            width: 100%;
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
        }
        
        .upgrade-button:disabled {
            background: var(--border);
            cursor: not-allowed;
        }
        
        .upgrade-button.owned {
            background: var(--success);
        }
        
        .tasks-grid {
            display: grid;
            gap: 12px;
        }
        
        .task-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .task-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .task-progress {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }
        
        .task-reward {
            font-size: 12px;
            color: var(--drevo);
            font-weight: 600;
        }
        
        .task-button {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
        }
        
        .task-button:disabled {
            background: var(--border);
            cursor: not-allowed;
        }
        
        .wallet-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .wallet-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .wallet-address {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            padding: 6px 10px;
            border-radius: 10px;
        }
        
        .ton-connect-button {
            min-width: 120px;
        }
        
        .collectibles-grid {
            display: grid;
            gap: 12px;
        }
        
        .collectible-card {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .collectible-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .collectible-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .collectible-stock {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .collectible-image {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: transparent;
        }
        
        .collectible-image img {
            width: 180px;
            height: 180px;
            object-fit: contain;
            border-radius: 12px;
            pointer-events: none;
            -webkit-user-drag: none;
        }
        
        .collectible-info {
            padding: 16px;
            border-top: 1px solid var(--border);
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .info-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .info-value {
            font-weight: 500;
            font-size: 14px;
        }
        
        .price-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }
        
        .price-tag.ton {
            color: var(--ton);
        }
        
        .price-tag.drevo {
            color: var(--drevo);
        }
        
        .buy-section {
            padding: 16px;
            border-top: 1px solid var(--border);
        }
        
        .buy-button {
            width: 100%;
            background: var(--gradient);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .buy-button.drevo {
            background: var(--drevo);
        }
        
        .buy-button.vip {
            background: var(--vip);
            color: #000;
        }
        
        .buy-button:disabled {
            background: var(--border);
            cursor: not-allowed;
        }
        
        .profile-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .dreams-section {
            background: var(--gradient);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .dreams-avatar {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .dreams-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            -webkit-user-drag: none;
        }
        
        .dreams-content {
            flex: 1;
        }
        
        .dreams-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .dreams-text {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .promo-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .promo-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .promo-input {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .promo-input input {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .promo-input button {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .admin-section {
            background: var(--vip);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .admin-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #000;
        }
        
        .admin-input {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .admin-input input {
            flex: 1;
            background: rgba(255,255,255,0.9);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: #000;
            font-size: 14px;
        }
        
        .admin-input button {
            background: #000;
            color: var(--vip);
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .promo-management {
            margin-top: 12px;
        }
        
        .promo-management input {
            width: 100%;
            background: rgba(255,255,255,0.9);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            color: #000;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .promo-management button {
            background: #000;
            color: var(--vip);
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .user-details {
            flex: 1;
        }
        
        .username {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .member-since {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .collection-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .collection-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            border: 1px solid var(--border);
            cursor: pointer;
        }
        
        .collection-image {
            width: 60px;
            height: 60px;
            margin: 0 auto 8px;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .collection-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 6px;
            pointer-events: none;
            -webkit-user-drag: none;
        }
        
        .collection-name {
            font-size: 11px;
            font-weight: 500;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 40px;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 12px 16px;
            backdrop-filter: blur(20px);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .nav-item.active {
            background: rgba(0, 136, 204, 0.1);
            color: var(--accent);
        }
        
        .nav-icon {
            font-size: 18px;
        }
        
        .nav-label {
            font-size: 10px;
            font-weight: 500;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            width: 100%;
            max-width: 360px;
            border: 1px solid var(--border);
            overflow: hidden;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            text-align: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .modal-image {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: transparent;
        }
        
        .modal-image img {
            width: 180px;
            height: 180px;
            object-fit: contain;
            border-radius: 12px;
            pointer-events: none;
            -webkit-user-drag: none;
        }
        
        .modal-details {
            padding: 20px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .detail-value {
            font-weight: 500;
            font-size: 14px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
        }
        
        .ton-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--ton);
            font-weight: 600;
        }
        
        .drevo-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--drevo);
            font-weight: 600;
        }
        
        .vip-badge {
            background: var(--vip);
            color: #000;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .online-players {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .online-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--success);
        }
        
        .players-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }
        
        .player-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .player-clicks {
            font-size: 12px;
            color: var(--drevo);
            font-weight: 600;
        }
        
        .player-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .player-status.offline {
            background: var(--energy);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">DREVO</div>
            <div class="balance-section">
                <div class="energy-section"><span id="energy">10000/10000</span></div>
                <div class="balance-card"><span class="balance-icon">D</span><span id="balance">0</span></div>
            </div>
        </div>
        
        <!-- Clicker Page -->
        <div id="clicker-page" class="page active">
            <div class="online-players">
                <div class="online-title">
                    <i class="fas fa-users"></i>
                    Online Players (<span id="online-count">1</span>)
                </div>
                <div class="players-list" id="players-list">
                    <div class="player-item">
                        <div class="player-name">You</div>
                        <div class="player-clicks" id="user-clicks">0 clicks</div>
                        <div class="player-status"></div>
                    </div>
                </div>
            </div>
            
            <div class="clicker-section">
                <div class="clicker-circle" id="clicker">
                    <img src="https://i.postimg.cc/R01F9bD4/IMG-20251002-224117-911.jpg" alt="DREVO" class="drevo-avatar">
                </div>
                
                <div class="clicker-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="clicks-per-second">0</div>
                        <div class="stat-label">Per Second</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-clicks">0</div>
                        <div class="stat-label">Total Clicks</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">Clicker Upgrades</h2>
                
                <div class="upgrades-grid" id="upgrades-container">
                    <!-- Upgrades will be added by JS -->
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">Tasks</h2>
                
                <div class="tasks-grid" id="tasks-container">
                    <!-- Tasks will be added by JS -->
                </div>
            </div>
        </div>
        
        <!-- Market Page -->
        <div id="market-page" class="page">
            <div class="wallet-card">
                <div class="wallet-info">
                    <div class="wallet-address" id="wallet-address">Not connected</div>
                    <div id="connect-btn" class="ton-connect-button"></div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">Gifts</h2>
                
                <div class="collectibles-grid">
                    <!-- Cat for DREVO -->
                    <div class="collectible-card">
                        <div class="collectible-header">
                            <div class="collectible-title">Cat</div>
                            <div class="collectible-stock" id="cat-stock">Stock: 1200</div>
                        </div>
                        
                        <div class="collectible-image">
                            <img src="https://i.postimg.cc/x1MzBqft/ezgif-78d2cebd8effbe.gif" alt="Cat">
                        </div>
                        
                        <div class="collectible-info">
                            <div class="info-row">
                                <div class="info-label">Cost</div>
                                <div class="price-tag drevo">
                                    <i class="fas fa-coins"></i>
                                    <span>20000 DREVO</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="buy-section">
                            <button class="buy-button drevo" onclick="buyGift('cat')">
                                <i class="fas fa-coins"></i>
                                Buy for 20000 DREVO
                            </button>
                        </div>
                    </div>
                    
                    <!-- Christian Cross for TON -->
                    <div class="collectible-card">
                        <div class="collectible-header">
                            <div class="collectible-title">Christian Cross</div>
                            <div class="collectible-stock" id="cross-stock">Stock: 800</div>
                        </div>
                        
                        <div class="collectible-image">
                            <img src="https://i.postimg.cc/HL2pCGh5/ezgif-825d8532b9c755.gif" alt="Christian Cross">
                        </div>
                        
                        <div class="collectible-info">
                            <div class="info-row">
                                <div class="info-label">Cost</div>
                                <div class="price-tag ton">
                                    <i class="fab fa-toncoin"></i>
                                    <span>0.5 TON</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="buy-section">
                            <button class="buy-button" onclick="buyGift('cross')">
                                <i class="fab fa-toncoin"></i>
                                Buy for 0.5 TON
                            </button>
                        </div>
                    </div>
                    
                    <!-- Cybercar for TON -->
                    <div class="collectible-card">
                        <div class="collectible-header">
                            <div class="collectible-title">Cybercar</div>
                            <div class="collectible-stock" id="cybercar-stock">Stock: 100</div>
                        </div>
                        
                        <div class="collectible-image">
                            <img src="https://i.postimg.cc/1zrHK4Vn/ezgif-8f92856a9fc001-2.gif" alt="Cybercar">
                        </div>
                        
                        <div class="collectible-info">
                            <div class="info-row">
                                <div class="info-label">Cost</div>
                                <div class="price-tag ton">
                                    <i class="fab fa-toncoin"></i>
                                    <span>0.5 TON</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="buy-section">
                            <button class="buy-button" onclick="buyGift('cybercar')">
                                <i class="fab fa-toncoin"></i>
                                Buy for 0.5 TON
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile Page -->
        <div id="profile-page" class="page">
            <div class="profile-card">
                <div class="dreams-section">
                    <div class="dreams-avatar">
                        <img src="https://i.postimg.cc/R01F9bD4/IMG-20251002-224117-911.jpg" alt="DREVO">
                    </div>
                    <div class="dreams-content">
                        <div class="dreams-title">Dreams Come True</div>
                        <div class="dreams-text">Your dreams become reality with DREVO</div>
                    </div>
                </div>
                
                <div class="promo-section">
                    <div class="promo-title">
                        <i class="fas fa-ticket-alt"></i>
                        Promo Codes
                    </div>
                    <div class="promo-input">
                        <input type="text" id="promo-code" placeholder="Enter promo code">
                        <button onclick="redeemPromoCode()">Redeem</button>
                    </div>
                    <div class="info-text" id="promo-message">Enter promo code to get rewards</div>
                </div>
                
                <!-- Admin Panel for @clanffys -->
                <div class="admin-section" id="admin-panel" style="display: none;">
                    <div class="admin-title">
                        <i class="fas fa-crown"></i>
                        Admin Panel
                    </div>
                    <div class="admin-input">
                        <input type="number" id="admin-coins" placeholder="Amount of coins">
                        <button onclick="addCoins()">Add Coins</button>
                    </div>
                    <div class="promo-management">
                        <input type="text" id="new-promo-code" placeholder="New promo code name">
                        <input type="number" id="new-promo-reward" placeholder="Reward amount">
                        <input type="number" id="new-promo-uses" placeholder="Max uses (0 = infinite)">
                        <button onclick="createPromoCode()">Create Promo</button>
                        <button onclick="deletePromoCode()">Delete Promo</button>
                    </div>
                    <div class="info-text" style="color: #000;">Admin functions for managing promos</div>
                </div>
                
                <div class="user-info">
                    <div class="avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <div class="username" id="user-name">User</div>
                        <div class="member-since" id="user-joined">Member since: Loading...</div>
                    </div>
                </div>
                
                <div class="collection-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total-gifts">0</div>
                        <div class="stat-label">Gifts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-spent">0</div>
                        <div class="stat-label">Spent</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">My Gifts</h2>
                
                <div id="gifts-container">
                    <div class="empty-state" id="empty-gifts">
                        <i class="fas fa-gift"></i>
                        <p>No gifts yet</p>
                    </div>
                    <div class="collection-grid" id="gifts-grid" style="display: none;">
                        <!-- Gifts will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showPage('clicker-page')">
            <div class="nav-icon">
                <i class="fas fa-hand-pointer"></i>
            </div>
            <div class="nav-label">Clicker</div>
        </div>
        <div class="nav-item" onclick="showPage('market-page')">
            <div class="nav-icon">
                <i class="fas fa-gift"></i>
            </div>
            <div class="nav-label">Market</div>
        </div>
        <div class="nav-item" onclick="showPage('profile-page')">
            <div class="nav-icon">
                <i class="fas fa-user"></i>
            </div>
            <div class="nav-label">Profile</div>
        </div>
    </div>
    
    <!-- Gift Modal -->
    <div class="modal" id="gift-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">Cat</div>
            </div>
            
            <div class="modal-image">
                <img src="" alt="" id="modal-image">
            </div>
            
            <div class="modal-details">
                <div class="detail-row">
                    <div class="detail-label">Owner</div>
                    <div class="detail-value" id="modal-owner">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Date</div>
                    <div class="detail-value" id="modal-date">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Cost</div>
                    <div class="detail-value">
                        <div class="drevo-badge" id="modal-cost">
                            <i class="fas fa-coins"></i>
                            <span>20000 DREVO</span>
                        </div>
                    </div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Availability</div>
                    <div class="detail-value" id="modal-availability">-</div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="buy-button" onclick="closeModal()" style="background: var(--border);">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // Глобальное состояние через Telegram Cloud Storage
        let globalState = {
            gifts: {
                cat: { stock: 1200, price: 20000, currency: 'DREVO' },
                cross: { stock: 800, price: 0.5, currency: 'TON' },
                cybercar: { stock: 100, price: 0.5, currency: 'TON' }
            },
            players: {},
            totalClicks: 0
        };
        
        // Локальное состояние пользователя
        let userState = {
            balance: 0,
            energy: 10000,
            totalClicks: 0,
            clicksPerSecond: 0,
            upgrades: {
                autoClicker: { level: 0, cost: 100, cps: 1 },
                energyBoost: { level: 0, cost: 500, cps: 5 }
            },
            gifts: [],
            promoUsed: []
        };
        
        // Инициализация игры
        async function initGame() {
            await loadGlobalState();
            loadUserState();
            setupCloudStorageListener();
            renderUpgrades();
            renderTasks();
            updateUI();
            startGameLoop();
            
            // Установка информации пользователя
            const user = tg.initDataUnsafe?.user;
            if (user) {
                document.getElementById('user-name').textContent = user.first_name || 'User';
                document.getElementById('user-joined').textContent = `Member since: ${new Date().toLocaleDateString()}`;
                if (user.username === 'clanffys') {
                    document.getElementById('admin-panel').style.display = 'block';
                }
            }
        }
        
        // Загрузка глобального состояния из Cloud Storage
        async function loadGlobalState() {
            try {
                const saved = await tg.CloudStorage.getItem('global_state');
                if (saved) {
                    globalState = JSON.parse(saved);
                    console.log('73 Loaded global state from Cloud Storage');
                } else {
                    // Первая инициализация - сохраняем начальные значения
                    await saveGlobalState();
                }
            } catch (error) {
                console.log('74 Error loading global state:', error);
            }
        }
        
        // Сохранение глобального состояния в Cloud Storage
        async function saveGlobalState() {
            try {
                await tg.CloudStorage.setItem('global_state', JSON.stringify(globalState));
                console.log('94 Saved global state to Cloud Storage');
            } catch (error) {
                console.log('74 Error saving global state:', error);
            }
        }
        
        // Настройка слушателя изменений в Cloud Storage
        function setupCloudStorageListener() {
            tg.CloudStorage.onChanged((changed) => {
                if (changed.global_state) {
                    const newState = JSON.parse(changed.global_state);
                    globalState = newState;
                    console.log('94 Global state updated from Cloud Storage');
                    updateGiftStocks();
                    updateOnlinePlayers();
                    updateUI();
                }
            });
        }
        
        // Обновление стоков подарков
        function updateGiftStocks() {
            document.getElementById('cat-stock').textContent = `Stock: ${globalState.gifts.cat.stock}`;
            document.getElementById('cross-stock').textContent = `Stock: ${globalState.gifts.cross.stock}`;
            document.getElementById('cybercar-stock').textContent = `Stock: ${globalState.gifts.cybercar.stock}`;
        }
        
        // Обновление списка онлайн игроков
        function updateOnlinePlayers() {
            const now = Date.now();
            const onlinePlayers = Object.values(globalState.players).filter(
                player => now - player.lastSeen < 30000 // 30 секунд онлайн
            );
            
            document.getElementById('online-count').textContent = onlinePlayers.length;
            const playersList = document.getElementById('players-list');
            
            // Очищаем и добавляем текущего пользователя
            playersList.innerHTML = `
                <div class="player-item">
                    <div class="player-name">You</div>
                    <div class="player-clicks">${userState.totalClicks} clicks</div>
                    <div class="player-status"></div>
                </div>
            `;
            
            // Добавляем других онлайн игроков
            onlinePlayers.forEach(player => {
                if (player.name !== (tg.initDataUnsafe?.user?.first_name || 'User')) {
                    const playerItem = document.createElement('div');
                    playerItem.className = 'player-item';
                    playerItem.innerHTML = `
                        <div class="player-name">${player.name}</div>
                        <div class="player-clicks">${player.clicks} clicks</div>
                        <div class="player-status"></div>
                    `;
                    playersList.appendChild(playerItem);
                }
            });
        }
        
        // Обновление информации об игроке онлайн
        async function updatePlayerOnline() {
            const user = tg.initDataUnsafe?.user;
            if (user) {
                const userId = user.id.toString();
                globalState.players[userId] = {
                    name: user.first_name || 'User',
                    clicks: userState.totalClicks,
                    lastSeen: Date.now()
                };
                await saveGlobalState();
            }
        }
        
        // Покупка подарка - ОБНОВЛЯЕТСЯ ДЛЯ ВСЕХ ПОЛЬЗОВАТЕЛЕЙ
        async function buyGift(giftType) {
            const gift = globalState.gifts[giftType];
            
            if (!gift) {
                alert('Gift not found!');
                return;
            }
            
            if (gift.stock <= 0) {
                alert('This gift is out of stock!');
                return;
            }
            
            if (gift.currency === 'DREVO' && userState.balance < gift.price) {
                alert('Not enough DREVO coins!');
                return;
            }
            
            // Списание баланса
            if (gift.currency === 'DREVO') {
                userState.balance -= gift.price;
            } else {
                // Логика TON платежа
                if (!window.tonConnectUI?.connected) {
                    alert('Please connect your TON wallet first!');
                    return;
                }
                alert('TON payment would be implemented here');
                return;
            }
            
            // 97 УМЕНЬШЕНИЕ СТОКА ДЛЯ ВСЕХ ПОЛЬЗОВАТЕЛЕЙ В РЕАЛЬНОМ ВРЕМЕНИ
            globalState.gifts[giftType].stock -= 1;
            
            // Добавление подарка пользователю
            userState.gifts.push({
                type: giftType,
                name: getGiftName(giftType),
                image: getGiftImage(giftType),
                cost: gift.price,
                currency: gift.currency,
                date: new Date().toISOString()
            });
            
            // Сохранение в Cloud Storage - ОБНОВИТСЯ У ВСЕХ ПОЛЬЗОВАТЕЛЕЙ
            await saveGlobalState();
            saveUserState();
            updateUI();
            
            alert(`73 You bought ${getGiftName(giftType)}! Stock updated for ALL users worldwide.`);
        }
        
        // Остальные функции...
        function loadUserState() {
            const saved = localStorage.getItem('drevo_user_state');
            if (saved) {
                userState = JSON.parse(saved);
            }
        }
        
        function saveUserState() {
            localStorage.setItem('drevo_user_state', JSON.stringify(userState));
        }
        
        function startGameLoop() {
            setInterval(() => {
                // Авто-кликеры
                userState.balance += userState.clicksPerSecond;
                
                // Регенерация энергии
                if (userState.energy < 10000) {
                    userState.energy = Math.min(userState.energy + 100, 10000);
                }
                
                updateUI();
                saveUserState();
                
                // Обновление онлайн статуса
                updatePlayerOnline();
            }, 1000);
        }
        
        // Обработчик клика
        document.getElementById('clicker').addEventListener('click', async () => {
            if (userState.energy >= 10) {
                userState.balance += 1;
                userState.totalClicks += 1;
                userState.energy -= 10;
                
                // Обновляем глобальную статистику кликов
                globalState.totalClicks += 1;
                await saveGlobalState();
                
                updateUI();
                saveUserState();
                
                // Обновляем онлайн статус
                await updatePlayerOnline();
            }
        });
        
        function buyUpgrade(upgradeKey) {
            const upgrade = userState.upgrades[upgradeKey];
            if (userState.balance >= upgrade.cost) {
                userState.balance -= upgrade.cost;
                upgrade.level += 1;
                userState.clicksPerSecond += upgrade.cps;
                upgrade.cost = Math.floor(upgrade.cost * 1.5);
                renderUpgrades();
                updateUI();
                saveUserState();
            }
        }
        
        function renderUpgrades() {
            const container = document.getElementById('upgrades-container');
            container.innerHTML = '';
            
            Object.entries(userState.upgrades).forEach(([key, upgrade]) => {
                const card = document.createElement('div');
                card.className = 'upgrade-card';
                card.innerHTML = `
                    <div class="upgrade-header">
                        <div class="upgrade-icon">
                            <i class="fas fa-${key === 'autoClicker' ? 'robot' : 'bolt'}"></i>
                        </div>
                        <div class="upgrade-info">
                            <div class="upgrade-title">${key === 'autoClicker' ? 'Auto Clicker' : 'Energy Boost'}</div>
                            <div class="upgrade-description">+${upgrade.cps} DREVO per second</div>
                            <div class="upgrade-price">Cost: ${upgrade.cost} DREVO</div>
                        </div>
                    </div>
                    <button class="upgrade-button ${upgrade.level > 0 ? 'owned' : ''}" 
                            onclick="buyUpgrade('${key}')"
                            ${userState.balance < upgrade.cost ? 'disabled' : ''}>
                        ${upgrade.level > 0 ? 'UPGRADE' : 'BUY'}
                    </button>
                `;
                container.appendChild(card);
            });
        }
        
        function renderTasks() {
            // Реализация задач...
        }
        
        function updateUI() {
            document.getElementById('balance').textContent = Math.floor(userState.balance);
            document.getElementById('energy').textContent = `${Math.floor(userState.energy)}/10000`;
            document.getElementById('clicks-per-second').textContent = userState.clicksPerSecond;
            document.getElementById('total-clicks').textContent = userState.totalClicks;
            document.getElementById('user-clicks').textContent = `${userState.totalClicks} clicks`;
            
            document.getElementById('total-gifts').textContent = userState.gifts.length;
            document.getElementById('total-spent').textContent = userState.gifts.reduce((sum, gift) => sum + gift.cost, 0);
            
            updateGiftStocks();
            updateOnlinePlayers();
        }
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        function getGiftName(type) {
            const names = {
                cat: 'Cat',
                cross: 'Christian Cross',
                cybercar: 'Cybercar'
            };
            return names[type] || type;
        }
        
        function getGiftImage(type) {
            const images = {
                cat: 'https://i.postimg.cc/x1MzBqft/ezgif-78d2cebd8effbe.gif',
                cross: 'https://i.postimg.cc/HL2pCGh5/ezgif-825d8532b9c755.gif',
                cybercar: 'https://i.postimg.cc/1zrHK4Vn/ezgif-8f92856a9fc001-2.gif'
            };
            return images[type] || '';
        }
        
        function redeemPromoCode() {
            // Реализация промо-кодов...
        }
        
        function addCoins() {
            // Админ функция...
        }
        
        function closeModal() {
            document.getElementById('gift-modal').classList.remove('active');
        }
        
        // Инициализация TON Connect
        let tonConnectUI;
        function initTONConnect() {
            tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://drevo-game.github.io/drevo/tonconnect-manifest.json',
                buttonRootId: 'connect-btn'
            });
        }
        
        // Запуск игры
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            initTONConnect();
        });
    </script>
</body>
</html>